<!DOCTYPE html>
<!-- VISTA -->
<html>
	
	<head>
		<script src = "https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
	</head>
	
	<body ng-app = "myApp">
  
		<div ng-controller = "myCtrl">
			<input type = "file" file-model = "myFile" name="myFile"/>
			<button ng-click = "uploadFile()">upload me</button>
			<p>{{msg}}</p>
		</div>
		
		<script>
			var myApp = angular.module('myApp', []);
			
			myApp.directive('fileModel', ['$parse', function ($parse) {
				return {
					restrict: 'A',
					link: function(scope, element, attrs) {
						var model = $parse(attrs.fileModel);
						var modelSetter = model.assign;
						
						element.bind('change', function(){
							scope.$apply(function(){
								modelSetter(scope, element[0].files[0]);
							});
						});
					}
				};
			}]);
		
			myApp.service('fileUpload', ['$http', function ($http) {
				this.uploadFileToUrl = function(file, uploadUrl){
					var fd = new FormData();
					var msj;
					fd.append('file', file);
				
					$http.post(uploadUrl, fd, {
						headers: {'Content-Type': 'undefined'}
					})
				
					.success(function(data){
						alert(data);
					})
				
					.error(function(data){
					 alert(data);
					});
				return msj;
				}
			}]);
		
			myApp.controller('myCtrl', ['$scope', 'fileUpload', function($scope, fileUpload){
				$scope.uploadFile = function(){
					var file = $scope.myFile;

					//console.log('file is ' );
					//console.dir(file);
					
					var uploadUrl = "/rest";
					fileUpload.uploadFileToUrl(file, uploadUrl);
				};
			}]);
		
		</script>
		
	</body>
</html>
